<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lights Out Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .light-tile {
            transition: background-color 0.3s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), inset 0 1px 2px rgba(255, 255, 255, 0.5);
            cursor: pointer;
            border-radius: 0.75rem; /* rounded-xl */
        }
        .light-tile:active {
            transform: scale(0.95);
        }
        .light-tile.on {
            background-color: #facc15; /* yellow-400 */
            box-shadow: 0 0 20px #facc15, 0 4px 6px rgba(0, 0, 0, 0.1), inset 0 1px 2px rgba(255, 255, 255, 0.7);
        }
        .light-tile.off {
            background-color: #94a3b8; /* slate-400 */
        }
        /* Win Modal styles */
        #win-modal {
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-lg mx-auto bg-white rounded-2xl shadow-xl p-4 sm:p-6 md:p-8">
        <header class="text-center mb-6">
            <h1 class="text-4xl sm:text-5xl font-bold text-slate-900">Lights Out</h1>
            <p class="text-slate-500 mt-2">Turn off all the lights to win!</p>
        </header>

        <div id="game-info" class="w-full flex justify-between items-center mb-4 px-2">
            <div class="text-left">
                <span class="text-slate-500">Level</span>
                <p id="level-display" class="text-2xl font-bold text-blue-600">1</p>
            </div>
            <div class="text-right">
                <span class="text-slate-500">Moves</span>
                <p id="moves-display" class="text-2xl font-bold text-red-600">0</p>
            </div>
        </div>

        <!-- Game Board -->
        <div id="board-container" class="aspect-square w-full max-w-md mx-auto mb-6">
            <div id="board" class="grid h-full w-full gap-2 sm:gap-3">
                <!-- Tiles will be generated by JS -->
            </div>
        </div>

        <!-- Controls -->
        <div class="grid grid-cols-2 gap-4">
            <button id="restart-btn" class="bg-orange-500 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-orange-600 disabled:bg-slate-300 disabled:cursor-not-allowed transition-colors">Restart Level</button>
            <button id="new-game-btn" class="bg-green-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-green-700 transition-colors">New Game</button>
        </div>
    </div>

    <!-- Win Modal -->
    <div id="win-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden opacity-0">
        <div class="bg-white rounded-2xl shadow-xl p-8 text-center transform scale-95 transition-transform duration-300">
            <h2 id="win-title" class="text-4xl font-bold text-slate-900 mb-2">You Win!</h2>
            <p id="win-message" class="text-slate-500 mb-6">You solved the puzzle!</p>
            <button id="next-level-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 transition-colors">Next Level</button>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const boardElement = document.getElementById('board');
        const levelDisplay = document.getElementById('level-display');
        const movesDisplay = document.getElementById('moves-display');
        const restartBtn = document.getElementById('restart-btn');
        const newGameBtn = document.getElementById('new-game-btn');
        const winModal = document.getElementById('win-modal');
        const winTitle = document.getElementById('win-title');
        const winMessage = document.getElementById('win-message');
        const nextLevelBtn = document.getElementById('next-level-btn');

        // --- Game State ---
        let board = [];
        let currentLevel = 0;
        let moves = 0;
        let boardSize = 0;

        // --- Level Configurations ---
        // Pre-defined solvable patterns for Lights Out
        const levels = [
            { size: 3, pattern: [[1,1,0],[1,0,1],[0,1,1]] },
            { size: 4, pattern: [[0,1,1,0],[1,0,0,1],[1,0,0,1],[0,1,1,0]] },
            { size: 5, pattern: [[0,1,1,1,0],[1,0,1,0,1],[1,1,0,1,1],[1,0,1,0,1],[0,1,1,1,0]] },
            { size: 5, pattern: [[1,1,0,1,1],[1,0,0,0,1],[0,0,0,0,0],[1,0,0,0,1],[1,1,0,1,1]] },
            { size: 5, pattern: [[1,0,1,0,1],[0,0,0,0,0],[1,0,0,0,1],[0,0,0,0,0],[1,0,1,0,1]] },
        ];

        // --- Game Logic ---
        function initGame() {
            // Load progress from localStorage or start at level 0
            const savedLevel = localStorage.getItem('lightsOutLevel');
            currentLevel = savedLevel ? parseInt(savedLevel, 10) : 0;
            if (currentLevel >= levels.length) {
                currentLevel = 0; // Reset if saved level is out of bounds
            }
            loadLevel(currentLevel);
        }

        function loadLevel(levelIndex) {
            currentLevel = levelIndex;
            localStorage.setItem('lightsOutLevel', currentLevel); // Save progress
            
            const levelData = levels[levelIndex];
            boardSize = levelData.size;
            // Deep copy the pattern to the board state
            board = levelData.pattern.map(row => [...row]);
            
            moves = 0;
            updateDisplays();
            renderBoard();
        }

        function renderBoard() {
            boardElement.innerHTML = '';
            // Update grid template columns based on board size
            boardElement.style.gridTemplateColumns = `repeat(${boardSize}, minmax(0, 1fr))`;

            for (let r = 0; r < boardSize; r++) {
                for (let c = 0; c < boardSize; c++) {
                    const tile = document.createElement('div');
                    tile.dataset.row = r;
                    tile.dataset.col = c;
                    tile.className = 'light-tile';
                    tile.classList.add(board[r][c] ? 'on' : 'off');
                    tile.addEventListener('click', () => handleTileClick(r, c));
                    boardElement.appendChild(tile);
                }
            }
        }
        
        function handleTileClick(row, col) {
            if (winModal.classList.contains('hidden') === false) return; // Prevent clicks when modal is open

            moves++;
            
            toggleLight(row, col);
            toggleLight(row - 1, col); // Top
            toggleLight(row + 1, col); // Bottom
            toggleLight(row, col - 1); // Left
            toggleLight(row, col + 1); // Right
            
            updateBoardUI();
            updateDisplays();
            
            checkWinCondition();
        }

        function toggleLight(r, c) {
            // Check if the coordinates are within the board boundaries
            if (r >= 0 && r < boardSize && c >= 0 && c < boardSize) {
                board[r][c] = 1 - board[r][c]; // Flip 0 to 1 or 1 to 0
            }
        }
        
        function updateBoardUI() {
            for (let r = 0; r < boardSize; r++) {
                for (let c = 0; c < boardSize; c++) {
                    const tile = boardElement.querySelector(`[data-row='${r}'][data-col='${c}']`);
                    if (tile) {
                        tile.classList.toggle('on', board[r][c] === 1);
                        tile.classList.toggle('off', board[r][c] === 0);
                    }
                }
            }
        }
        
        function checkWinCondition() {
            const isBoardOff = board.every(row => row.every(light => light === 0));
            if (isBoardOff) {
                setTimeout(showWinModal, 300); // Small delay for better UX
            }
        }
        
        function showWinModal() {
            if (currentLevel < levels.length - 1) {
                 winTitle.textContent = `Level ${currentLevel + 1} Cleared!`;
                 winMessage.textContent = `You solved it in ${moves} moves. Ready for the next challenge?`;
                 nextLevelBtn.textContent = 'Next Level';
                 nextLevelBtn.onclick = () => {
                     hideWinModal();
                     loadLevel(currentLevel + 1);
                 };
            } else {
                 winTitle.textContent = `Congratulations!`;
                 winMessage.textContent = `You've completed all the levels! You are a Lights Out master.`;
                 nextLevelBtn.textContent = 'Play Again';
                 nextLevelBtn.onclick = () => {
                     hideWinModal();
                     loadLevel(0);
                 };
            }

            winModal.classList.remove('hidden');
            setTimeout(() => {
                winModal.classList.remove('opacity-0');
                winModal.querySelector('div').classList.remove('scale-95');
            }, 10);
        }

        function hideWinModal() {
            winModal.classList.add('opacity-0');
            winModal.querySelector('div').classList.add('scale-95');
            setTimeout(() => {
                winModal.classList.add('hidden');
            }, 300);
        }

        function updateDisplays() {
            levelDisplay.textContent = currentLevel + 1;
            movesDisplay.textContent = moves;
        }

        // --- Event Listeners ---
        restartBtn.addEventListener('click', () => loadLevel(currentLevel));
        newGameBtn.addEventListener('click', () => loadLevel(0));
        
        // --- Initial Load ---
        window.onload = initGame;
    </script>
</body>
</html>

